@page "/recordings"

@rendermode InteractiveServer

@using Recordings.Shared.DTOs
@using Recordings.UI.Models

@inject ILogger<RecordingsDashboard> Logger

<PageTitle>Recordings</PageTitle>

<div class="container" style="margin-top: 30px;">
    <div class="row">
        <div class="col-3">
            <div>
                <Search OnSearch="HandleSearch"/>
            </div>
            <div style="margin-top: 10px;">
                <DateSelector OnDateSelected="HandleDateSelected" />
            </div>
        </div>
        <div class="col-9">
            <div>
                <AudioPlayer Track="@SelectedTrack" />
            </div>
            <div style="margin-top: 10px;">
                <Playlist Filter="@TrackFilter" OnTrackSelected="HandleTrackSelected" />
            </div>
        </div>
    </div>
</div>

@code {

    private RecordingDto? SelectedTrack { get; set; }
    private TrackFilter TrackFilter { get; set; } = new TrackFilter(); 

    private void HandleDateSelected(string date)
    {
        TrackFilter = new TrackFilter { Value = date, Type = TrackFilterType.Date };
        SelectedTrack = null;
        StateHasChanged();
    }

    private void HandleSearch(string searchText)
    {
        TrackFilter = new TrackFilter { Value = searchText, Type = TrackFilterType.Title };
        SelectedTrack = null;
        StateHasChanged();
    }

    private void HandleTrackSelected(RecordingDto track)
    {
        SelectedTrack = track;
        StateHasChanged();
    }
}